# Гайд Користувача: Керування Depth-Bot

## 1. Вступ

Ласкаво просимо до гайду користувача Depth-Bot!

**Depth-Bot** — це автоматизований інструмент, розроблений для імітації активного та ліквідного ринку на нашій криптовалютній біржі. Він наповнює книгу ордерів (стакан) для обраних торгових пар, створює видимість торгової активності та забезпечує базову ліквідність для користувачів.

Цей гайд призначений для адміністраторів та осіб, відповідальних за керування ботами. Він фокусується на використанні **веб-інтерфейсу керування ботами** для їх налаштування, запуску, зупинки та моніторингу. Процес інсталяції бота тут **не** розглядається.

## 2. Доступ до Інтерфейсу Керування

Веб-інтерфейс для керування ботами доступний за різними адресами для тестових та демонстраційних середовищ:

*   **Dev Середовище (Розробка):**
    *   Frontend Керування Ботами: [`http://164.68.117.90:5502/`](http://164.68.117.90:5502/)
    *   *Додатково:* API Swagger (документація API): [`http://164.68.117.90:5501/`](http://164.68.117.90:5501/)
    *   *Додатково:* Основний Frontend Біржі: `dev.newexchanger.com`
*   **Demo Середовище (Демонстрація):**
    *   Frontend Керування Ботами: [`http://164.68.117.90:6502/`](http://164.68.117.90:6502/)
    *   *Додатково:* API Swagger: [`http://164.68.117.90:6501/`](http://164.68.117.90:6501/)
    *   *Додатково:* Основний Frontend Біржі: `new.newexchanger.com`

Далі в цьому гайді будуть використовуватися скріншоти для ілюстрації інтерфейсу.

## 3. Принцип Роботи Бота (Коротко)

Бот працює в безперервному циклі для кожної активної торгової пари:

1.  **Отримує дані:** Запитує актуальні ціни та обсяги зі стакану зовнішньої біржі (`binance` або `kraken`).
2.  **Розраховує ціни:** Визначає діапазон цін для своїх ордерів на основі даних зовнішньої біржі та параметрів `market_gap` і `price_factor`.
3.  **Розраховує обсяги:** Вибирає випадковий обсяг для нових ордерів в межах `trade_amount_min` та `trade_amount_max`.
4.  **Керує ордерами:**
    *   Перевіряє поточну кількість своїх ордерів на біржі.
    *   Якщо ордерів замало (менше `min_orders`), додає нові лімітні ордери на купівлю та продаж.
    *   Якщо ордерів забагато (більше `min_orders + 1`), скасовує "зайві" (зазвичай найменш вигідні).
    *   Періодично скасовує та одразу ставить нові ордери, навіть якщо кількість в нормі, для імітації динаміки ринку.
5.  **Взаємодіє з користувачами:** Якщо реальний користувач біржі виконує ордер, розміщений ботом, відбувається звичайна угода.
6.  **Пауза:** Робить випадкову паузу (згідно `frequency_from`/`to`) перед наступним циклом.

`[СКРІНШОТ: Приклад стакану (order book) на біржі, де видно ордери, розміщені ботом]`

**Безпека (`DeadWatcher`):** Існує окремий сервіс `DeadWatcher`, який стежить за активністю ботів. Якщо бот не надсилає сигнал "я живий" протягом певного часу, `DeadWatcher` автоматично скасовує всі ордери цього бота на біржі для запобігання "завислим" ордерам у разі збою.

## 4. Огляд Головного Екрану (`Bots list`)

Після входу в інтерфейс ви побачите головний екран зі списком усіх налаштованих ботів.

`[СКРІНШОТ: Головний екран зі списком ботів (`Bots list`)]`

Таблиця містить наступні колонки:

*   `Pair`: Торгова пара, якою керує бот (напр., `BTC_USDC`).
*   `Exchange`: Зовнішня біржа, з якої бот бере ринкові дані (`binance` або `kraken`).
*   `Status`: Поточний стан бота:
    *   `ACTIVE`: Бот працює та розміщує ордери.
    *   `INACTIVE`: Бот зупинений і неактивний.
*   `Orders`: Мінімальна цільова кількість ордерів (`min_orders`).
*   `Min/Max amount`: Діапазон обсягу одного ордера (`trade_amount_min`/`max`).
*   `Frequency (sec)`: Діапазон затримки між циклами (`frequency_from`/`to`).
*   `Deviation (%)`: Параметри ціноутворення (`price_factor`, `market_gap`).
*   `Market maker (%)`: Ймовірність ринкового ордера (`market_maker_order_probability`). **Рекомендовано 0%.**
*   `Actions`: Доступні дії для кожного бота:
    *   **Перегляд (Синя іконка ока):** Відкриває детальну сторінку налаштувань та балансів цього бота (`Bot details`).
    *   **Зупинити/Запустити (Жовта іконка паузи / Зелена іконка play):** Змінює статус бота між `ACTIVE` та `INACTIVE`. **Важливо:** При зупинці (`INACTIVE`) бот автоматично **скасовує всі свої активні ордери** на біржі.
    *   **Видалити (Червона іконка кошика):** Повністю видаляє конфігурацію бота з системи. **Важливо:** При видаленні бот також **скасовує всі свої активні ордери**.

У верхній частині екрану є кнопка `Create bot`, яка використовується для додавання нового бота.

## 5. Створення Нового Бота

Щоб додати нового бота для керування певною торговою парою:

1.  Натисніть кнопку `Create bot` на головному екрані.
2.  Заповніть форму налаштувань нового бота.

`[СКРІНШОТ: Форма створення нового бота (`Create bot`)]`

Основні параметри для налаштування (детальний опис див. у `BotConfig_Parameters.md`):

*   `Pair Name`: Введіть назву торгової пари точно так, як вона існує на біржі (напр., `BTC_USDT`, `ETH_BTC`).
*   `Exchange`: Виберіть зовнішню біржу (`binance` або `kraken`), з якої бот буде брати дані про ціни.
*   `Min Orders`: Цільова мінімальна кількість ордерів на кожній стороні стакану (купівля/продаж), яку бот буде підтримувати.
*   `Min Amount` (`trade_amount_min`): Мінімальний обсяг одного ордера.
*   `Max Amount` (`trade_amount_max`): Максимальний обсяг одного ордера. **Дуже важливо:** Переконайтеся, що на рахунку бота в адмін-панелі біржі достатньо коштів для покриття цього максимального обсягу!
*   `Frequency From` (`frequency_from`): Мінімальна випадкова затримка (сек) між циклами дій бота.
*   `Frequency To` (`frequency_to`): Максимальна випадкова затримка (сек) між циклами дій бота.
    *   **Чому діапазон?** Використання діапазону частоти (наприклад, від 0 до 5 секунд) замість фіксованого значення робить дії бота менш передбачуваними та роботизованими. Це краще імітує природну, нерівномірну активність реального ринку, де угоди та оновлення ордерів відбуваються з різними інтервалами.
*   `Price Factor` (`price_factor`): Визначає "ширину" цінового діапазону (в %), в якому бот розміщує ордери відносно базової ціни. Цей параметр візуально впливає на щільність ордерів у стакані: **менше значення (напр., 1-2%)** означає, що ордери будуть сконцентровані ближче до поточної ринкової ціни, створюючи "щільніший" вигляд стакану. **Більше значення (напр., 10%)** розкидає ордери ширше, роблячи стакан візуально "рідшим".
*   `Market Gap` (`market_gap`): Гарантований мінімальний відсоток відступу ордерів бота від реальних ринкових цін зовнішньої біржі. Це **ключовий параметр безпеки**, оскільки він гарантує, що:
    *   **Захист від арбітражу:** Ордери бота ніколи не будуть вигіднішими за ціни на зовнішній біржі, що унеможливлює миттєвий арбітраж проти бота.
    *   **Потенційна вигода для біржі:** Коли користувач укладає угоду з ордером бота, біржа (через бота) купує трохи дешевше або продає трохи дорожче, ніж поточна ціна на зовнішньому ринку.
*   `Market Maker Order Probability`: Ймовірність (в %) того, що бот виконає ринковий ордер замість лімітного. **Рекомендовано встановлювати 0% через нестабільність функції.**

Після заповнення всіх полів натисніть кнопку для збереження конфігурації. Новий бот з'явиться у списку зі статусом `INACTIVE`.

### 5.1. Рекомендовані Стартові Налаштування

Наведені нижче параметри є **рекомендованими стартовими значеннями** для нового бота, що використовує **Binance** як джерело даних. Їх, можливо, потрібно буде коригувати залежно від конкретної торгової пари, її волатильності та бажаної щільності стакану:

*   `Exchange`: `binance`
*   `Min Orders`: `12`
*   `Min Amount`: `0.1` (або мінімально допустимий обсяг для пари)
*   `Max Amount`: `1` (або обсяг, який відповідає середній активності пари та наявним балансам)
*   `Frequency From`: `0`
*   `Frequency To`: `5`
*   `Price Factor`: `2` (для відносно щільного стакану)
*   `Market Gap`: `1` (стандартний безпечний відступ)
*   `Market Maker Order Probability`: `0`

**Завжди перевіряйте наявність достатніх балансів перед запуском бота!**

## 6. Перегляд та Керування Існуючим Ботом (`Bot details`)

Щоб переглянути детальну конфігурацію, баланси та керувати існуючим ботом, натисніть іконку **ока** у списку ботів. Відкриється сторінка `Bot details`.

`[СКРІНШОТ: Сторінка деталей бота (`Bot details`)]`

На цій сторінці ви побачите:

*   **Повні параметри конфігурації** бота, які ви вказали при створенні або редагуванні.
*   **Кнопки керування:**
    *   `Edit`: Відкриває форму для зміни параметрів цього бота (аналогічну формі створення).
    *   `Enable`/`Disable`: Запускає (`ACTIVE`) або зупиняє (`INACTIVE`) бота. Пам'ятайте, що зупинка скасовує ордери.
    *   `Delete`: Видаляє конфігурацію бота та скасовує його ордери.
*   **Баланси Бота для Цієї Пари (`Bot Balances`):** Ця секція показує **поточні реальні баланси** на рахунку бота **саме для тих двох валют, що складають цю торгову пару**. Дані оновлюються в реальному часі.
    *   `Available`: Доступно для торгівлі.
    *   `Frozen`: Заблоковано у відкритих ордерах (зазвичай 0, якщо ордери ставить лише бот).
    *   `Total`: Загальний баланс валюти.
    *   **Примітка:** Баланси можуть змінюватися, навіть якщо цей конкретний бот зупинений, якщо інші активні боти торгують тими ж валютами.

`[СКРІНШОТ: Форма редагування бота (після натискання `Edit`)]`

## 7. Моніторинг Балансів

Окрім балансів для конкретної пари на сторінці `Bot details`, існує окрема вкладка/розділ `Bot Balances` (назва може трохи відрізнятися в інтерфейсі), де відображаються **загальні поточні баланси всіх валют** на рахунку, який використовується усіма ботами.

`[СКРІНШОТ: Вкладка/Сторінка загальних балансів бота (`Bot Balances`)]`

*   Використовуйте кнопку `Refresh Balances`, щоб оновити дані.
*   Форма `Top Up Balance` призначена **лише для імітації** поповнення під час тестування і **не виконує реального зарахування коштів**.

**Критично Важливо: Підтримка Реальних Балансів!**

Для коректної роботи всіх ботів **необхідно постійно підтримувати достатній реальний баланс** усіх необхідних валют на спеціальному рахунку бота. Це робиться через **адміністративну панель самої біржі**, а не через інтерфейс керування ботами.

*   Переконайтеся, що баланс кожної валюти достатній для покриття `trade_amount_max`, встановленого для ботів, що торгують цією валютою.
*   Регулярно перевіряйте та поповнюйте баланси через адмін-панель біржі (URL для розробки: `https://newexchanger.com/admin/payment/wallet/fill_request/list`, URL для демо уточніть). Недостатній баланс призведе до збоїв у роботі бота та неможливості розмістити ордери потрібного обсягу.

## 8. Важливі Аспекти

*   **Вимоги до Балансу:** Повторимо: **завжди підтримуйте достатній реальний баланс** в адмін-панелі біржі. Це найважливіша умова стабільної роботи.
*   **Збереження Конфігурації:** Налаштування ботів зберігаються у файлі `bots_config.json` **всередині Docker-контейнера**. Якщо контейнер буде перезапущено без збереження цього файлу назовні (через Docker Volumes), всі зміни, зроблені через інтерфейс, **будуть втрачені**. Зверніться до DevOps для налаштування збереження конфігурації.
*   **Безпека Інтерфейсу:** На даний момент **відсутня авторизація** для доступу до інтерфейсу керування ботами та його API. Це становить ризик несанкціонованого доступу. Необхідно впровадити механізми автентифікації/авторизації.
*   **Цикл Прибутку:** Бот наразі не реалізує повний цикл фіксації прибутку (наприклад, через хеджування на зовнішній біржі). Зміна балансу відбувається лише локально в результаті угод з користувачами.

Сподіваємося, цей гайд допоможе вам ефективно керувати Depth-Bot. 